<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TTS í…ŒìŠ¤íŠ¸</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            max-width: 600px;
            margin: 0 auto;
        }
        button {
            padding: 10px 20px;
            margin: 10px;
            font-size: 16px;
            cursor: pointer;
        }
        #log {
            background: #f0f0f0;
            padding: 10px;
            margin-top: 20px;
            border-radius: 5px;
            white-space: pre-wrap;
            font-family: monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <h1>TTS ìŒì„± ì¶œë ¥ í…ŒìŠ¤íŠ¸</h1>

    <button onclick="testSimpleTTS()">ê°„ë‹¨í•œ TTS í…ŒìŠ¤íŠ¸</button>
    <button onclick="testKoreanTTS()">í•œêµ­ì–´ TTS í…ŒìŠ¤íŠ¸</button>
    <button onclick="listVoices()">ìŒì„± ëª©ë¡ ë³´ê¸°</button>
    <button onclick="testWithVoiceSelection()">ìŒì„± ì„ íƒ í›„ í…ŒìŠ¤íŠ¸</button>
    <button onclick="clearLog()">ë¡œê·¸ ì§€ìš°ê¸°</button>

    <div id="log"></div>

    <script>
        const log = (message) => {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            logDiv.textContent += `[${timestamp}] ${message}\n`;
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(message);
        };

        // ê°„ë‹¨í•œ TTS í…ŒìŠ¤íŠ¸
        function testSimpleTTS() {
            log('ğŸ¤ ê°„ë‹¨í•œ TTS í…ŒìŠ¤íŠ¸ ì‹œì‘');

            if (!window.speechSynthesis) {
                log('âŒ ë¸Œë¼ìš°ì €ê°€ TTSë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤');
                return;
            }

            const text = 'ì•ˆë…•í•˜ì„¸ìš”. TTS í…ŒìŠ¤íŠ¸ì…ë‹ˆë‹¤.';
            const utterance = new SpeechSynthesisUtterance(text);

            utterance.lang = 'ko-KR';
            utterance.volume = 1.0;
            utterance.rate = 1.0;
            utterance.pitch = 1.0;

            utterance.onstart = () => log('âœ… ìŒì„± ì¶œë ¥ ì‹œì‘');
            utterance.onend = () => log('âœ… ìŒì„± ì¶œë ¥ ì™„ë£Œ');
            utterance.onerror = (e) => log(`âŒ ì—ëŸ¬: ${e.error}`);

            // ì´ì „ ìŒì„± ì·¨ì†Œ
            window.speechSynthesis.cancel();

            // ì•½ê°„ì˜ ì§€ì—° í›„ ì‹œì‘
            setTimeout(() => {
                window.speechSynthesis.speak(utterance);
                log('ğŸ”Š speak() í˜¸ì¶œë¨');
            }, 100);
        }

        // í•œêµ­ì–´ ìŒì„± ì„ íƒ í…ŒìŠ¤íŠ¸
        function testKoreanTTS() {
            log('ğŸ¤ í•œêµ­ì–´ TTS í…ŒìŠ¤íŠ¸ ì‹œì‘');

            const voices = window.speechSynthesis.getVoices();
            log(`ğŸ“‹ ì‚¬ìš© ê°€ëŠ¥í•œ ìŒì„±: ${voices.length}ê°œ`);

            if (voices.length === 0) {
                log('âš ï¸ ìŒì„± ëª©ë¡ì´ ë¹„ì–´ìˆìŒ. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”.');

                // voiceschanged ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
                window.speechSynthesis.onvoiceschanged = () => {
                    log('ğŸ”„ ìŒì„± ëª©ë¡ì´ ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ í´ë¦­í•´ì£¼ì„¸ìš”.');
                };
                return;
            }

            const koreanVoice = voices.find(voice =>
                voice.lang === 'ko-KR' || voice.lang.startsWith('ko')
            );

            const text = 'í•œêµ­ì–´ ìŒì„±ìœ¼ë¡œ í…ŒìŠ¤íŠ¸í•©ë‹ˆë‹¤.';
            const utterance = new SpeechSynthesisUtterance(text);

            if (koreanVoice) {
                utterance.voice = koreanVoice;
                log(`âœ… í•œêµ­ì–´ ìŒì„± ì°¾ìŒ: ${koreanVoice.name}`);
            } else {
                log('âš ï¸ í•œêµ­ì–´ ìŒì„±ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ');
            }

            utterance.lang = 'ko-KR';
            utterance.onstart = () => log('âœ… ìŒì„± ì¶œë ¥ ì‹œì‘');
            utterance.onend = () => log('âœ… ìŒì„± ì¶œë ¥ ì™„ë£Œ');
            utterance.onerror = (e) => log(`âŒ ì—ëŸ¬: ${e.error}`);

            window.speechSynthesis.cancel();
            setTimeout(() => {
                window.speechSynthesis.speak(utterance);
                log('ğŸ”Š speak() í˜¸ì¶œë¨');
            }, 100);
        }

        // ìŒì„± ëª©ë¡ ë³´ê¸°
        function listVoices() {
            log('ğŸ“‹ ìŒì„± ëª©ë¡ ì¡°íšŒ ì¤‘...');

            const voices = window.speechSynthesis.getVoices();

            if (voices.length === 0) {
                log('âš ï¸ ìŒì„± ëª©ë¡ì´ ë¹„ì–´ìˆìŒ');

                // ìŒì„± ë¡œë“œ ì‹œë„
                window.speechSynthesis.onvoiceschanged = () => {
                    const newVoices = window.speechSynthesis.getVoices();
                    log(`ğŸ”„ ìŒì„± ëª©ë¡ ë¡œë“œë¨: ${newVoices.length}ê°œ`);
                    newVoices.forEach((voice, index) => {
                        log(`  ${index}: ${voice.name} (${voice.lang}) ${voice.localService ? 'ë¡œì»¬' : 'ì›ê²©'}`);
                    });
                };

                // ì¼ë¶€ ë¸Œë¼ìš°ì €ì—ì„œ í•„ìš”í•œ íŠ¸ë¦­
                const dummy = new SpeechSynthesisUtterance('');
                window.speechSynthesis.speak(dummy);
                window.speechSynthesis.cancel();

                return;
            }

            log(`ì´ ${voices.length}ê°œì˜ ìŒì„± ë°œê²¬:`);
            voices.forEach((voice, index) => {
                log(`  ${index}: ${voice.name} (${voice.lang}) ${voice.localService ? 'ë¡œì»¬' : 'ì›ê²©'}`);
            });

            const koreanVoices = voices.filter(v => v.lang.includes('ko'));
            log(`\ní•œêµ­ì–´ ìŒì„±: ${koreanVoices.length}ê°œ`);
            koreanVoices.forEach(v => {
                log(`  - ${v.name}`);
            });
        }

        // ìŒì„± ì„ íƒ í›„ í…ŒìŠ¤íŠ¸
        function testWithVoiceSelection() {
            log('ğŸ¤ ìŒì„± ì„ íƒ í…ŒìŠ¤íŠ¸ ì‹œì‘');

            const voices = window.speechSynthesis.getVoices();
            if (voices.length === 0) {
                log('âŒ ìŒì„±ì´ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. "ìŒì„± ëª©ë¡ ë³´ê¸°"ë¥¼ ë¨¼ì € í´ë¦­í•˜ì„¸ìš”.');
                return;
            }

            // ìš°ì„ ìˆœìœ„: Google > Samsung > ê¸°íƒ€ í•œêµ­ì–´
            let selectedVoice = voices.find(v => v.lang.includes('ko') && v.name.includes('Google'));
            if (!selectedVoice) {
                selectedVoice = voices.find(v => v.lang.includes('ko') && v.name.includes('Samsung'));
            }
            if (!selectedVoice) {
                selectedVoice = voices.find(v => v.lang.includes('ko'));
            }
            if (!selectedVoice && voices.length > 0) {
                selectedVoice = voices[0];
            }

            if (selectedVoice) {
                log(`âœ… ì„ íƒëœ ìŒì„±: ${selectedVoice.name}`);

                const utterance = new SpeechSynthesisUtterance('ì´ ìŒì„±ìœ¼ë¡œ í…ŒìŠ¤íŠ¸í•©ë‹ˆë‹¤.');
                utterance.voice = selectedVoice;
                utterance.lang = 'ko-KR';

                utterance.onstart = () => log('âœ… ìŒì„± ì¶œë ¥ ì‹œì‘');
                utterance.onend = () => log('âœ… ìŒì„± ì¶œë ¥ ì™„ë£Œ');
                utterance.onerror = (e) => log(`âŒ ì—ëŸ¬: ${e.error}`);

                window.speechSynthesis.cancel();
                setTimeout(() => {
                    window.speechSynthesis.speak(utterance);
                    log('ğŸ”Š speak() í˜¸ì¶œë¨');
                }, 100);
            } else {
                log('âŒ ì‚¬ìš© ê°€ëŠ¥í•œ ìŒì„±ì´ ì—†ìŠµë‹ˆë‹¤');
            }
        }

        function clearLog() {
            document.getElementById('log').textContent = '';
            log('ë¡œê·¸ê°€ ì§€ì›Œì¡ŒìŠµë‹ˆë‹¤');
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìŒì„± ë¯¸ë¦¬ ë¡œë“œ
        window.addEventListener('load', () => {
            log('ğŸš€ í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ');

            // ìŒì„± ëª©ë¡ ì´ˆê¸°í™”
            if (window.speechSynthesis) {
                const voices = window.speechSynthesis.getVoices();
                if (voices.length > 0) {
                    log(`âœ… ì´ˆê¸° ìŒì„± ë¡œë“œ: ${voices.length}ê°œ`);
                } else {
                    log('â³ ìŒì„± ë¡œë”© ì¤‘...');
                    window.speechSynthesis.onvoiceschanged = () => {
                        const newVoices = window.speechSynthesis.getVoices();
                        log(`âœ… ìŒì„± ë¡œë“œ ì™„ë£Œ: ${newVoices.length}ê°œ`);
                    };
                }
            } else {
                log('âŒ ì´ ë¸Œë¼ìš°ì €ëŠ” Web Speech APIë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤');
            }
        });
    </script>
</body>
</html>